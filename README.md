# DSA Django Template

A quick start template, optimised for adherence to internal standards and development speed.

## Features

- üîê Configuration via an encrypted `secrets.env.enc` file powered by [django-encrypted-secrets](https://github.com/nzaillian/django-encrypted-secrets)
- üî® Integration with ADFS and Azure AD
- üßë‚Äçü§ù‚Äçüßë Role-based access control for pages and resources
- ‚ú® Styling using [TailwindCSS](https://tailwindcss.com/docs) (with configured CSS purging for production)
- ‚öôÔ∏è Automated pre-commit linting and formating
- üëÆ CSDP compliant session management (see this [issue](https://github.com/DSA-CoE/dsa_django_template/issues/1) for more info)
- üõ°Ô∏è Equipped with best practices for security (see this [issue](https://github.com/DSA-CoE/dsa_django_template/issues/20) for more info)
- üß™ Testing suites, coverage checks ready out of the box
- ‚ùå Secure with SSL as default
- ‚ùå Docker-ready for easy deployment

## To install & run

1. Clone the repository

    ```bash
    git clone git@github.com:DSA-CoE/dsa_django_template.git
    ```

2. Create a virtual environment and activate it

    ```bash
    python -m virtualenv .venv
    source .venv/bin/activate
    ```

3. Install the necessary dependencies

    ```bash
    pip install -r requirements-dev.txt

    # If in prod, run this
    pip install -r requirements.txt
    ```

4. Install `pre-commit`

    ```bash
    pre-commit install
    ```

    NOTE: DO NOT RUN `pre-commit run --all-files` as this will override excluded fields specified in the config file (i.e. `.pre-commit-config.yaml`).

    (Optional) To test out `pre-commit`, run the following:

    ```bash
    git add . # Stage changes first
    pre-commit run # Do not run with `--all-files`!
    ```

5. Create secrets file

    ```bash
    python manage.py init_secrets --mode=env
    ```

6. To edit the secrets.env.enc file, run:

    ```bash
    python manage.py edit_secrets
    ```

    Copy paste the required keys from `.env.example` and provide the values.

    NOTE: This command depends on the `EDITOR` env variable to run your environment default editor. If you're on a UNIX environment, you can set an editor like vim to be your default by running `export EDITOR=/usr/bin/vim`. If you want to use VSCode, run `export EDITOR="code -w"`.

7. Run migration suite

    ```bash
    python manage.py migrate
    ```

8. Create a superuser

    ```bash
    python manage.py createsuperuser
    ```

9. Create a cache table (for session management)

    ```bash
    python manage.py createcachetable
    ```

10. Serve the app

    ```bash
    python manage.py runserver
    ```

11. Remove the git connection to the original repo, and push the new project to a new GitHub repo

    ```bash
    # 1. Remove current git information
    rm -rf .git
    # 2. Initialize new git repo
    git init
    # 3. Rename the "dsa_django_template" folders to your new project name, <new_name>
    # 4. Search and replace the word "dsa_django_template" with <new_name> for all files using VSCode by pressing Ctrl+Shift+H (or Cmd+Shift+H for Mac)
    # 5. Commit new changes
    git add .
    git commit -m "First commit"
    # 6. Create a new repo in GitHub & copy the GitHub page link
    # 7. Set up connection to the GitHub repo
    git remote add origin <github_repo_link>
    git push --set-upstream origin master
    # 8. You're all set!
    ```

## Create a new Django app

Because this template uses a different project structure than what's generated by the `django-admin startproject` command, simply running `django-admin startapp <app_name>` won't work. So here's how you would create an app:

1. First, create a directory for your app inside the `/apps` directory

    ```bash
    mkdir dsa_django_template/apps/<app_name>
    # or 
    mkdir <project_name>/apps/<app_name>
    ```

2. Then, create a Django app by specifying the directory of your new app

    ```bash
    django-admin startapp <appname> dsa_django_template/apps/<app_name>
    # or
    django-admin startapp <app_name> <project_name>/apps/<app_name>
    ```

## Setting up Azure AD

For information on how to set up Azure AD, go [here](./docs/setting_up_azure_ad.md).

## Testing

Testing is powered by [pytest-django](https://github.com/pytest-dev/pytest-django) with coverage check by [pytest-cov](https://github.com/pytest-dev/pytest-cov).

Tests should be in their own `tests` folders under their respectives apps and should be prefixed with `test_<test_name>.py`.

To run tests:

```bash
pytest
```

With code coverage:

```bash
pytest --cov=dsa_django_template
or 
pytest --cov=<project_name>
```
